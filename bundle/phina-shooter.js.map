{"version":3,"sources":["main.js","application.js","assets.js","danmaku.js","color.js","bombdisplay.js","bullet.js","enemy.js","backgroundlayer.js","bulletlayer.js","effectlayer.js","mainlayer.js","sidebarlayer.js","hudlabel.js","itemdisplay.js","outlinedsprite.js","player.js","scorelabel.js","shot.js","titlelogolabel.js","zankidisplay.js","bulletconfig.js","gamedata.js","background.js","endingscene.js","gameoverscene.js","gamescene.js","loadingscene.js","nameentryscene.js","resultscene.js","settingscene.js","titlescene.js","tutorialscene.js","gamesequence.js","mainsequence.js","rankingscene.js","background1.js","stage.js","stage1.js","textureedit.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"phina-shooter.js","sourcesContent":["var SCREEN_WIDTH = 480;\r\nvar SCREEN_HEIGHT = 320;\r\n// var SCREEN_WIDTH = 720;\r\n// var SCREEN_HEIGHT = 480;\r\n// var SCREEN_WIDTH = 960;\r\n// var SCREEN_HEIGHT = 640;\r\n\r\nvar GAMEAREA_WIDTH = SCREEN_HEIGHT * 0.7;\r\nvar GAMEAREA_HEIGHT = SCREEN_HEIGHT;\r\n\r\nvar SIDEBAR_WIDTH = (SCREEN_WIDTH - GAMEAREA_WIDTH) * 0.5;\r\nvar SIDEBAR_HEIGHT = SCREEN_HEIGHT;\r\n\r\nvar FONT_SIZE_XL = ~~(0.07 * SCREEN_WIDTH);\r\nvar FONT_SIZE_L = ~~(0.03 * SCREEN_WIDTH);\r\nvar FONT_SIZE_M = ~~(0.02 * SCREEN_WIDTH);\r\nvar FONT_SIZE_S = ~~(0.01 * SCREEN_WIDTH);\r\n\r\nphina.main(function() {\r\n  ps.Color.initialize();\r\n\r\n  var app = ps.Application();\r\n  app.run();\r\n  \r\n  app.enableStats();\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Application\", {\r\n    superClass: \"phina.display.CanvasApp\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        query: \"#app\",\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n      });\r\n      this.fps = 60;\r\n      this.canvas.context.imageSmoothingEnabled = true;\r\n      this.domElement.style.imageRendering = \"pixelated\";\r\n\r\n      this.replaceScene(ps.MainSequence());\r\n\r\n      this.gamepads = phina.input.GamepadManager();\r\n    },\r\n\r\n    update: function() {\r\n      this.mouse.update();\r\n      this.touch.update();\r\n      this.touchList.update();\r\n      this.keyboard.update();\r\n      this.gamepads.update();\r\n    },\r\n\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Assets\", {\r\n    _static: {\r\n      get: function(name) {\r\n        switch (name) {\r\n\r\n          case \"common\":\r\n            return {\r\n              image: {\r\n                player: \"asset/player.png\",\r\n                bullet: \"asset/bullets.png\",\r\n                bomb: \"asset/bomb.png\",\r\n\r\n                zanki: \"asset/zankiIcon.png\",\r\n                bombIcon: \"asset/bombIcon.png\",\r\n              },\r\n\r\n              font: {\r\n                title: \"asset/Black_Ops_One/BlackOpsOne-Regular.ttf\",\r\n                main: \"asset/Press_Start_2P/PressStart2P-Regular.ttf\",\r\n                // mono: \"asset/VT323/VT323-Regular.ttf\",\r\n                mono: \"asset/Share_Tech_Mono/ShareTechMono-Regular.ttf\",\r\n              },\r\n            };\r\n\r\n          case \"stage0\":\r\n            return {\r\n              image: {\r\n                dummy: \"asset/zankiIcon.png\",\r\n              },\r\n            };\r\n\r\n          case \"stage1\":\r\n            return {\r\n              image: {\r\n                dummy: \"asset/zankiIcon.png\",\r\n              },\r\n            };\r\n\r\n          case \"stage2\":\r\n            return {\r\n              image: {\r\n                dummy: \"asset/zankiIcon.png\",\r\n              },\r\n            };\r\n\r\n          case \"stage3\":\r\n            return {\r\n              image: {\r\n                dummy: \"asset/zankiIcon.png\",\r\n              },\r\n            };\r\n\r\n          case \"stage4\":\r\n            return {\r\n              image: {\r\n                dummy: \"asset/zankiIcon.png\",\r\n              },\r\n            };\r\n\r\n        }\r\n      }\r\n    }\r\n  })\r\n});\r\n","phina.namespace(function() {\r\n\r\n  var action = bulletml.dsl.action;\r\n  var actionRef = bulletml.dsl.actionRef;\r\n  var bullet = bulletml.dsl.bullet;\r\n  var bulletRef = bulletml.dsl.bulletRef;\r\n  var fire = bulletml.dsl.fire;\r\n  var fireRef = bulletml.dsl.fireRef;\r\n  var changeDirection = bulletml.dsl.changeDirection;\r\n  var changeSpeed = bulletml.dsl.changeSpeed;\r\n  var accel = bulletml.dsl.accel;\r\n  var wait = bulletml.dsl.wait;\r\n  var vanish = bulletml.dsl.vanish;\r\n  var repeat = bulletml.dsl.repeat;\r\n  var bindVar = bulletml.dsl.bindVar;\r\n  var notify = bulletml.dsl.notify;\r\n  var direction = bulletml.dsl.direction;\r\n  var speed = bulletml.dsl.speed;\r\n  var horizontal = bulletml.dsl.horizontal;\r\n  var vertical = bulletml.dsl.vertical;\r\n  var fireOption = bulletml.dsl.fireOption;\r\n  var offsetX = bulletml.dsl.offsetX;\r\n  var offsetY = bulletml.dsl.offsetY;\r\n  var autonomy = bulletml.dsl.autonomy;\r\n\r\n  var interval = function(v) {\r\n    return wait(\"{0} * (0.3 + (1.0 - $densityRank) * 0.7)\".format(v));\r\n  };\r\n  var spd = function(v) {\r\n    return speed(\"{0} * (1.0 + $speedRank * 2.0)\".format(v));\r\n  };\r\n  var spdSeq = function(v) {\r\n    return speed(\"{0} * (1.0 + $speedRank * 2.0)\".format(v), \"sequence\");\r\n  };\r\n\r\n  var B0 = bullet({\r\n    type: 0\r\n  });\r\n  var B1 = bullet({\r\n    type: 1\r\n  });\r\n  var B2 = bullet({\r\n    type: 2\r\n  });\r\n  var B3 = bullet({\r\n    type: 3\r\n  });\r\n  var R0 = bullet({\r\n    type: 4\r\n  });\r\n  var R1 = bullet({\r\n    type: 5\r\n  });\r\n  var R2 = bullet({\r\n    type: 6\r\n  });\r\n  var R3 = bullet({\r\n    type: 7\r\n  });\r\n  var B4 = bullet({\r\n    type: 8\r\n  });\r\n  var B5 = bullet({\r\n    type: 9\r\n  });\r\n  var R4 = bullet({\r\n    type: 10\r\n  });\r\n  var R5 = bullet({\r\n    type: 11\r\n  });\r\n  var DM = bullet({\r\n    dummy: true\r\n  });\r\n\r\n  ps.danmaku = {};\r\n\r\n  // ザコ\r\n  var basic = function(dir) {\r\n    return new bulletml.Root({\r\n      top: action([\r\n        interval(10),\r\n        repeat(Infinity, [\r\n          fire(DM, spd(1), direction(dir)),\r\n          repeat(\"$burst\", [\r\n            fire(R2, spdSeq(0.15), direction(0, \"sequence\")),\r\n          ]),\r\n          interval(90),\r\n        ]),\r\n      ]),\r\n    });\r\n  };\r\n  ps.danmaku.basic = basic(0);\r\n  ps.danmaku.basicR1 = basic(-5);\r\n  ps.danmaku.basicL1 = basic(+5);\r\n  ps.danmaku.basicR2 = basic(-15);\r\n  ps.danmaku.basicL2 = basic(+15);\r\n\r\n  // ザコ3way\r\n  var basic3 = function(dir) {\r\n    return new bulletml.Root({\r\n      top: action([\r\n        interval(10),\r\n        repeat(Infinity, [\r\n          fire(DM, spd(1), direction(dir - 7)),\r\n          repeat(\"$burst\", [\r\n            fire(R2, spdSeq(0.05), direction(0, \"sequence\")),\r\n            fire(R2, spdSeq(0), direction(7, \"sequence\")),\r\n            fire(R2, spdSeq(0), direction(7, \"sequence\")),\r\n            fire(DM, spdSeq(0), direction(-14, \"sequence\")),\r\n          ]),\r\n          interval(90),\r\n        ]),\r\n      ]),\r\n    });\r\n  };\r\n  ps.danmaku.basic3 = basic3(0);\r\n  ps.danmaku.basic3R1 = basic3(-5);\r\n  ps.danmaku.basic3L1 = basic3(+5);\r\n  ps.danmaku.basic3R2 = basic3(-15);\r\n  ps.danmaku.basic3L2 = basic3(+15);\r\n\r\n  // Stage1 ------------------------------\r\n\r\n  // 黒川\r\n  ps.danmaku.kurokawa1 = new bulletml.Root({\r\n    top: action([\r\n      interval(20),\r\n      repeat(Infinity, [\r\n        repeat(3, [\r\n          fire(DM, spd(1.2)),\r\n          repeat(3, [\r\n            fire(R0, spdSeq(0), direction(0, \"sequence\")),\r\n            wait(6),\r\n          ]),\r\n          interval(12),\r\n        ]),\r\n        interval(50),\r\n      ]),\r\n    ]),\r\n  });\r\n\r\n  // 秋元\r\n  ps.danmaku.akimoto1 = new bulletml.Root({\r\n    top0: action([\r\n      repeat(Infinity, [\r\n        interval(20),\r\n        fire(R2, spd(1.0), direction(-30)),\r\n        repeat(8, [\r\n          fire(R2, spdSeq(0), direction(60 / 8, \"sequence\")),\r\n        ]),\r\n        interval(80),\r\n      ]),\r\n    ]),\r\n    top1: action([\r\n      repeat(Infinity, [\r\n        interval(50),\r\n        fire(R1, spd(1.2), direction(-10)),\r\n        repeat(6, [\r\n          fire(R1, spdSeq(0), direction(20 / 6, \"sequence\")),\r\n        ]),\r\n        interval(50),\r\n      ]),\r\n    ]),\r\n  });\r\n\r\n  // 黄瀬\r\n  ps.danmaku.kise1 = new bulletml.Root({\r\n    top: action([\r\n      interval(20),\r\n      repeat(Infinity, [\r\n        fire(DM, spd(1.4)),\r\n        repeat(12, [\r\n          fire(R4, spdSeq(0), direction(360 / (12 - 1), \"sequence\")),\r\n        ]),\r\n        interval(90),\r\n      ]),\r\n    ]),\r\n  });\r\n\r\n  // Stage2 ------------------------------\r\n  // Stage3 ------------------------------\r\n  // Stage4 ------------------------------\r\n  // Stage5 ------------------------------\r\n\r\n});\r\n","phina.namespace(function() {\r\n  // Color Palette by Paletton.com\r\n  // Palette URL: http://paletton.com/#uid=50f1n0kmGpNdfBfixtwqklHuEgU\r\n\r\n  phina.define(\"ps.Color\", {\r\n    init: function() {},\r\n    _static: {\r\n      pri: [],\r\n      sec0: [],\r\n      sec1: [],\r\n\r\n      initialize: function(scene) {\r\n        ps.Color.pri = [];\r\n        ps.Color.sec0 = [];\r\n        ps.Color.sec1 = [];\r\n        ps.Color.pria = [];\r\n        ps.Color.sec0a = [];\r\n        ps.Color.sec1a = [];\r\n\r\n        var p0 = 21;\r\n        var r = 140;\r\n        var s0 = (p0 - r + 360) % 360;\r\n        var s1 = (p0 + r + 360) % 360;\r\n\r\n        var size = 15;\r\n        var sMin = 48;\r\n        var sMax = 90;\r\n        var sLev = (sMax - sMin) / (size - 1);\r\n        var hMin = 5;\r\n        var hMax = 84;\r\n        var hLev = (hMax - hMin) / (size - 1);\r\n        Array.range(0, size).forEach(function(i) {\r\n          var s = Math.floor(sMin + sLev * i);\r\n          var h = Math.floor(hMin + hLev * i);\r\n          ps.Color.pri[i] = \"hsl({0},{1}%,{2}%)\"    .format(p0, s, h);\r\n          ps.Color.sec0[i] = \"hsl({0},{1}%,{2}%)\"   .format(s0, s, h);\r\n          ps.Color.sec1[i] = \"hsl({0},{1}%,{2}%)\"   .format(s1, s, h);\r\n          ps.Color.pria[i] = \"hsla({0},{1}%,{2}%,\"  .format(p0, s, h) + \"{0})\";\r\n          ps.Color.sec0a[i] = \"hsla({0},{1}%,{2}%,\" .format(s0, s, h) + \"{0})\";\r\n          ps.Color.sec1a[i] = \"hsla({0},{1}%,{2}%,\" .format(s1, s, h) + \"{0})\";\r\n        });\r\n\r\n        if (scene) ps.Color.test().addChildTo(scene);\r\n      },\r\n\r\n      test: function() {\r\n        var r = phina.display.CanvasElement();\r\n        ps.Color.pri.forEach(function(c, i) {\r\n          phina.display.RectangleShape({\r\n              width: 20,\r\n              height: 20,\r\n              fill: c,\r\n              stroke: null,\r\n            })\r\n            .setPosition(20 + i * 20, 20 + 20)\r\n            .addChildTo(r);\r\n        });\r\n\r\n        ps.Color.sec0.forEach(function(c, i) {\r\n          phina.display.RectangleShape({\r\n              width: 20,\r\n              height: 20,\r\n              fill: c,\r\n              stroke: null,\r\n            })\r\n            .setPosition(20 + i * 20, 20 + 0)\r\n            .addChildTo(r);\r\n        });\r\n\r\n        ps.Color.sec1.forEach(function(c, i) {\r\n          phina.display.RectangleShape({\r\n              width: 20,\r\n              height: 20,\r\n              fill: c,\r\n              stroke: null,\r\n            })\r\n            .setPosition(20 + i * 20, 20 + 40)\r\n            .addChildTo(r);\r\n        });\r\n\r\n        return r;\r\n      }\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.BombDisplay\", {\r\n    superClass: \"ps.ItemDisplay\",\r\n\r\n    init: function(initialValue) {\r\n      this.superInit(\"bombIcon\", initialValue);\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Bullet\", {\r\n    superClass: \"ps.OutlinedSprite\",\r\n\r\n    runner: null,\r\n    dummy: false,\r\n\r\n    init: function() {\r\n      this.superInit(\"bullet\", 24, 24);\r\n      this.age = 0;\r\n    },\r\n\r\n    update: function(app) {\r\n      var runner = this.runner;\r\n      if (runner) {\r\n        var pos = this.position;\r\n        \r\n        var bx = pos.x;\r\n        var by = pos.y;\r\n        runner.update();\r\n        var dx = runner.x - bx;\r\n        var dy = runner.y - by;\r\n\r\n        pos.x += dx * ps.Bullet.globalSpeedRate;\r\n        pos.y += dy * ps.Bullet.globalSpeedRate;\r\n\r\n        this.rotation = Math.atan2(pos.y - by, pos.x - bx) * 180 / Math.PI;\r\n\r\n        this.age += 1;\r\n      }\r\n    },\r\n\r\n    _static: {\r\n      globalSpeedRate: 1.0,\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Enemy\", {\r\n    superClass: \"phina.display.Sprite\",\r\n\r\n    hp: 0,\r\n    score: 0,\r\n\r\n    init: function(params) {\r\n      this.superInit(params.texture, params.width, params.height);\r\n      this.$extend(params);\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.BackgroundLayer\", {\r\n    superClass: \"phina.display.Layer\",\r\n\r\n    renderChildBySelf: true,\r\n    skip: false,\r\n\r\n    init: function(params) {\r\n      this.superInit({\r\n        width: GAMEAREA_WIDTH,\r\n        height: GAMEAREA_HEIGHT,\r\n      });\r\n      this.setOrigin(0, 0);\r\n      this.backgroundColor = params.backgroundColor;\r\n\r\n      this.stroke = params.stroke;\r\n      this.fill = params.fill;\r\n      this.lineWidth = 1;\r\n\r\n      this.camera = ps.bg.Camera().addChildTo(this);\r\n    },\r\n\r\n    update: function(app) {\r\n      this.skip = app.ticker.frame % 3 !== 0;\r\n    },\r\n\r\n    render: function() {\r\n      var self = this;\r\n      var cam = this.camera;\r\n      var canvas = this.canvas;\r\n      var w = canvas.canvas.width;\r\n      var h = canvas.canvas.height;\r\n\r\n      canvas.clearColor(this.backgroundColor);\r\n\r\n      if (self.stroke) {\r\n        canvas.strokeStyle = self.stroke;\r\n        canvas.context.lineWidth = self.lineWidth;\r\n      }\r\n      if (self.fill) {\r\n        canvas.fillStyle = self.fill;\r\n        canvas.fill();\r\n      }\r\n\r\n      for (var i = 0, len = this.children.length; i < len; i++) {\r\n        var child = this.children[i];\r\n        if (child instanceof ps.bg.Polygon) {\r\n          var src = child.render(cam);\r\n          var positions = [];\r\n          for (var s = 0, slen = src.length; s < slen; s++) {\r\n            var pos = src[s];\r\n            if (pos[3] < 0) {\r\n              positions = [];\r\n              break;\r\n            } else {\r\n              positions.push(((pos[0] / pos[3]) + 0.5) * w);\r\n              positions.push((-(pos[1] / pos[3]) + 0.5) * h);\r\n            }\r\n          }\r\n\r\n          var alpha = Math.clamp(1.0 - src[0][2] * 0.032, 0.0, 1.0);\r\n          if (alpha < 0.01) continue;\r\n          canvas.context.globalAlpha = alpha;\r\n\r\n          if (4 <= positions.length) {\r\n            canvas.beginPath();\r\n            canvas.lines.apply(canvas, positions);\r\n            canvas.closePath();\r\n            if (self.stroke) canvas.stroke();\r\n            if (self.fill) canvas.fill();\r\n          } else if (positions.length === 2) {\r\n            canvas.beginPath();\r\n            canvas.rect(positions[0], positions[1], 1, 1);\r\n            canvas.closePath();\r\n            if (self.stroke) canvas.stroke();\r\n            if (self.fill) canvas.fill();\r\n          }\r\n        }\r\n      }\r\n\r\n      canvas.context.globalAlpha = 1.0;\r\n    },\r\n\r\n    draw: function(canvas) {\r\n      if (!this.skip) this.render();\r\n\r\n      var image = this.canvas.domElement;\r\n      canvas.context.drawImage(image,\r\n        0, 0, image.width, image.height, -this.width * this.originX, -this.height * this.originY, this.width, this.height\r\n      );\r\n    },\r\n  });\r\n\r\n  phina.define(\"ps.bg.Camera\", {\r\n    superClass: \"phina.app.Element\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n\r\n      this.position = vec3.set(vec3.create(), 5, 3, 50);\r\n      this.target = vec3.set(vec3.create(), 0, 0, 0);\r\n      this.up = vec3.set(vec3.create(), 0, 1, 0);\r\n\r\n      this.vMatrix = mat4.create();\r\n      this.pMatrix = mat4.perspective(mat4.create(), 70, GAMEAREA_WIDTH / GAMEAREA_HEIGHT, 0.1, 10000);\r\n\r\n      this.vpMatrix = mat4.create();\r\n\r\n      this.needsUpdate = true;\r\n    },\r\n\r\n    update: function() {\r\n      if (this.needsUpdate) {\r\n        mat4.lookAt(this.vMatrix, this.position, this.target, this.up);\r\n        mat4.mul(this.vpMatrix, this.pMatrix, this.vMatrix);\r\n        this.needsUpdate = false;\r\n      }\r\n    },\r\n\r\n    _accessor: {\r\n      x: {\r\n        get: function() {\r\n          return this.position[0];\r\n        },\r\n        set: function(v) {\r\n          this.position[0] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      y: {\r\n        get: function() {\r\n          return this.position[1];\r\n        },\r\n        set: function(v) {\r\n          this.position[1] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      z: {\r\n        get: function() {\r\n          return this.position[2];\r\n        },\r\n        set: function(v) {\r\n          this.position[2] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      targetX: {\r\n        get: function() {\r\n          return this.target[0];\r\n        },\r\n        set: function(v) {\r\n          this.target[0] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      targetY: {\r\n        get: function() {\r\n          return this.target[1];\r\n        },\r\n        set: function(v) {\r\n          this.target[1] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      targetZ: {\r\n        get: function() {\r\n          return this.target[2];\r\n        },\r\n        set: function(v) {\r\n          this.target[2] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      upX: {\r\n        get: function() {\r\n          return this.up[0];\r\n        },\r\n        set: function(v) {\r\n          this.up[0] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      upY: {\r\n        get: function() {\r\n          return this.up[1];\r\n        },\r\n        set: function(v) {\r\n          this.up[1] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      upZ: {\r\n        get: function() {\r\n          return this.up[2];\r\n        },\r\n        set: function(v) {\r\n          this.up[2] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.bg.Polygon\", {\r\n    superClass: \"phina.app.Element\",\r\n\r\n    init: function(params) {\r\n      this.superInit();\r\n\r\n      this.vertices = params.vertices.map(function(vertex) {\r\n        return vec4.set(vec4.create(), vertex[0], vertex[1], vertex[2], 1);\r\n      });\r\n\r\n      this.calcPosition = this.vertices.map(function(vertex) {\r\n        return vec4.clone(vertex);\r\n      });\r\n\r\n      // this.rotation = quat.create();\r\n      this.translation = vec3.create();\r\n      // this.scale = vec3.set(vec3.create(), 1, 1, 1);\r\n\r\n      this.mMatrix = mat4.create();\r\n      this.mvpMatrix = mat4.create();\r\n\r\n      this.needsUpdate = true;\r\n    },\r\n\r\n    update: function() {\r\n      if (this.needsUpdate) {\r\n        // mat4.fromRotationTranslationScale(this.mMatrix, this.rotation, this.translation, this.scale);\r\n        mat4.fromTranslation(this.mMatrix, this.translation);\r\n        this.needsUpdate = false;\r\n      }\r\n    },\r\n\r\n    render: function(camera) {\r\n      var vertices = this.vertices;\r\n      var calcPosition = this.calcPosition;\r\n      var mvp = mat4.mul(this.mvpMatrix, camera.vpMatrix, this.mMatrix);\r\n\r\n      for (var i = 0, len = vertices.length; i < len; i++) {\r\n        var vertex = vertices[i];\r\n        vec4.transformMat4(calcPosition[i], vertex, mvp);\r\n      }\r\n\r\n      return calcPosition;\r\n    },\r\n\r\n    setTranslation: function(x, y, z) {\r\n      this.translation[0] = x;\r\n      this.translation[1] = y;\r\n      this.translation[2] = z;\r\n      return this;\r\n    },\r\n\r\n    _accessor: {\r\n      x: {\r\n        get: function() {\r\n          return this.translation[0];\r\n        },\r\n        set: function(v) {\r\n          this.translation[0] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      y: {\r\n        get: function() {\r\n          return this.translation[1];\r\n        },\r\n        set: function(v) {\r\n          this.translation[1] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n      z: {\r\n        get: function() {\r\n          return this.translation[2];\r\n        },\r\n        set: function(v) {\r\n          this.translation[2] = v;\r\n          this.needsUpdate = true;\r\n        }\r\n      },\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.BulletLayer\", {\r\n    superClass: \"phina.display.CanvasElement\",\r\n    \r\n    bullets: null,\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: GAMEAREA_WIDTH,\r\n        height: GAMEAREA_HEIGHT,\r\n      });\r\n      this.setOrigin(0, 0);\r\n      this.backgroundColor = null;\r\n      \r\n      this.bullets = [];\r\n    },\r\n\r\n    spawn: function(runner, spec) {\r\n      var bullet = ps.Bullet().addChildTo(this);\r\n      bullet.position.x = runner.x;\r\n      bullet.position.y = runner.y;\r\n      bullet.runner = runner;\r\n      bullet.frameIndex = spec.type || 0;\r\n      if (spec.dummy) {\r\n        bullet.visible = false;\r\n      }\r\n    },\r\n\r\n    update: function() {\r\n      var bs = this.children.slice(0);\r\n      for (var i = 0, len = bs.length; i < len; i++) {\r\n        var b = bs[i];\r\n        if (b.x < 0 || GAMEAREA_WIDTH < b.x || b.y < 0 || GAMEAREA_HEIGHT < b.y) {\r\n          b.remove();\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.EffectLayer\", {\r\n    superClass: \"phina.display.CanvasElement\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.gamescene.MainLayer\", {\r\n    superClass: \"phina.display.Layer\",\r\n\r\n    init: function(params) {\r\n      this.superInit({\r\n        width: GAMEAREA_WIDTH,\r\n        height: GAMEAREA_HEIGHT,\r\n      });\r\n      this.setOrigin(0, 0);\r\n      this.backgroundColor = null;\r\n\r\n      var self = this;\r\n\r\n      this.fromJSON({\r\n        children: {\r\n          backgroundLayer: {\r\n            className: params.stage.backgroundClassName,\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          scoreItemLayer: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          shotLayer: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"lighter\";\r\n            // },\r\n          },\r\n\r\n          effectLayer0: {\r\n            className: \"phina.display.CanvasElement\",\r\n            children: {\r\n              playerBurnerL: {\r\n                className: \"ps.AfterBurner\",\r\n                onenterframe: function() {\r\n                  this.position.x = self.player.position.x - 4;\r\n                  this.position.y = self.player.position.y + 10;\r\n                }\r\n              },\r\n              playerBurnerR: {\r\n                className: \"ps.AfterBurner\",\r\n                onenterframe: function() {\r\n                  this.position.x = self.player.position.x + 4;\r\n                  this.position.y = self.player.position.y + 10;\r\n                }\r\n              },\r\n            },\r\n          },\r\n\r\n          player: {\r\n            className: \"ps.Player\",\r\n            x: GAMEAREA_WIDTH * 0.5,\r\n            y: GAMEAREA_HEIGHT * 0.9,\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          itemLayer: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          enemyLayer: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          effectLayer1: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            // canvas.context.globalCompositeOperation = \"lighter\";\r\n            // },\r\n          },\r\n\r\n          bulletLayer: {\r\n            className: \"ps.BulletLayer\",\r\n            // draw: function(canvas) {\r\n            //   canvas.context.globalCompositeOperation = \"lighter\";\r\n            // },\r\n          },\r\n\r\n          dummy: {\r\n            className: \"phina.app.Element\",\r\n            // draw: function(canvas) {\r\n            //   canvas.context.globalCompositeOperation = \"source-over\";\r\n            // },\r\n          },\r\n\r\n          playerMarker: {\r\n            className: \"phina.display.CircleShape\",\r\n            arguments: {\r\n              radius: 3,\r\n              fill: ps.Color.sec0[13],\r\n              stroke: ps.Color.sec0[3],\r\n              strokeWidth: 1.3,\r\n            },\r\n            onenterframe: function(e) {\r\n              this.setScale(0.9 + Math.sin(e.app.ticker.frame * 0.3) * 0.1);\r\n              this.position = self.player.position;\r\n            },\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n  });\r\n});","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.gamescene.SideBarLayer\", {\r\n    superClass: \"phina.display.Layer\",\r\n\r\n    skipDraw: false,\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SIDEBAR_WIDTH,\r\n        height: SIDEBAR_HEIGHT,\r\n      });\r\n      this.setOrigin(0, 0);\r\n      this.backgroundColor = ps.Color.pri[0];\r\n      this.gridX = phina.util.Grid(SIDEBAR_WIDTH, 16);\r\n      this.gridY = phina.util.Grid(SIDEBAR_HEIGHT, 17);\r\n    },\r\n\r\n    bindGameData: function(gameData) {},\r\n\r\n    update: function(app) {\r\n      this.skipDraw = app.ticker.frame % 5 !== 0\r\n    },\r\n\r\n    draw: function(canvas) {\r\n      if (this.skipDraw) {\r\n        var image = this.canvas.domElement;\r\n        canvas.context.drawImage(image,\r\n          0, 0, image.width, image.height, -this.width * this.originX, -this.height * this.originY, this.width, this.height\r\n        );\r\n      } else {\r\n        phina.display.Layer.prototype.draw.call(this, canvas);\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  phina.define(\"ps.gamescene.LeftSideBar\", {\r\n    superClass: \"ps.gamescene.SideBarLayer\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n      this.fromJSON({\r\n        children: {\r\n          scoreLabel: {\r\n            className: \"ps.HudLabel\",\r\n            arguments: {\r\n              text: \"SCORE\",\r\n            },\r\n            x: this.gridX.span(1),\r\n            y: this.gridY.span(1),\r\n          },\r\n          score: {\r\n            className: \"ps.ScoreLabel\",\r\n            x: this.gridX.span(15),\r\n            y: this.gridY.span(2),\r\n          },\r\n\r\n          psycheLabel: {\r\n            className: \"ps.HudLabel\",\r\n            arguments: {\r\n              text: \"PSYCHE\",\r\n            },\r\n            x: this.gridX.span(1),\r\n            y: this.gridY.span(3),\r\n          },\r\n          psyche: {\r\n            className: \"ps.ScoreLabel\",\r\n            x: this.gridX.span(15),\r\n            y: this.gridY.span(4),\r\n          },\r\n\r\n          highScoreLabel: {\r\n            className: \"ps.HudLabel\",\r\n            arguments: {\r\n              text: \"HIGH SCORE\",\r\n            },\r\n            x: this.gridX.span(1),\r\n            y: this.gridY.span(15),\r\n          },\r\n          highScore: {\r\n            className: \"ps.ScoreLabel\",\r\n            x: this.gridX.span(15),\r\n            y: this.gridY.span(16),\r\n          },\r\n        }\r\n      });\r\n    },\r\n\r\n    bindGameData: function(gameData) {\r\n      gameData.bind(\"score\", this.score);\r\n      gameData.bind(\"psyche\", this.psyche);\r\n      gameData.bind(\"highScore\", this.highScore);\r\n    },\r\n\r\n  });\r\n\r\n  phina.define(\"ps.gamescene.RightSideBar\", {\r\n    superClass: \"ps.gamescene.SideBarLayer\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n      this.fromJSON({\r\n        children: {\r\n          zankiLabel: {\r\n            className: \"ps.HudLabel\",\r\n            arguments: {\r\n              text: \"ZANKI\",\r\n            },\r\n            x: this.gridX.span(1),\r\n            y: this.gridY.span(1),\r\n          },\r\n          zanki: {\r\n            className: \"ps.ZankiDisplay\",\r\n            arguments: 3 - 1,\r\n            x: this.gridX.span(15),\r\n            y: this.gridY.span(2),\r\n          },\r\n\r\n          bombLabel: {\r\n            className: \"ps.HudLabel\",\r\n            arguments: {\r\n              text: \"BOMB\",\r\n            },\r\n            x: this.gridX.span(1),\r\n            y: this.gridY.span(3),\r\n          },\r\n          bomb: {\r\n            className: \"ps.BombDisplay\",\r\n            arguments: 3,\r\n            x: this.gridX.span(15),\r\n            y: this.gridY.span(4),\r\n          },\r\n\r\n          gameTitleLabel: {\r\n            className: \"ps.TitleLogoLabel\",\r\n            x: this.gridX.center(),\r\n            y: this.gridY.span(16),\r\n          },\r\n        }\r\n      });\r\n    },\r\n\r\n    bindGameData: function(gameData) {\r\n      gameData.bind(\"zanki\", this.zanki);\r\n      gameData.bind(\"bomb\", this.bomb);\r\n    },\r\n\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.HudLabel\", {\r\n    superClass: \"phina.display.Label\",\r\n\r\n    init: function(options) {\r\n      this.superInit(options.$safe({\r\n        fill: ps.Color.sec0[14],\r\n        stroke: ps.Color.sec0[6],\r\n        fontSize: FONT_SIZE_M,\r\n        fontFamily: \"main\",\r\n        align: \"left\",\r\n        baseline: \"middle\",\r\n      }));\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.ItemDisplay\", {\r\n    superClass: \"phina.display.CanvasElement\",\r\n\r\n    init: function(textureName, initialValue) {\r\n      this.superInit();\r\n      this.setOrigin(1, 0.5);\r\n      this.textureName = textureName;\r\n\r\n      this._count = initialValue || 0;\r\n      this.updateView();\r\n    },\r\n\r\n    updateView: function() {\r\n      var self = this;\r\n      var t = this.textureName;\r\n      var count = this._count;\r\n\r\n      if (0 < count - this.children.length) {\r\n        (count - this.children.length).times(function(i) {\r\n          var newItem = phina.display.Sprite(t);\r\n          newItem.setPosition(self.children.length * -newItem.width * 1.02, 0)\r\n            .addChildTo(self);\r\n        });\r\n      }\r\n\r\n      this.children.forEach(function(child, i) {\r\n        child.visible = i < count;\r\n      });\r\n    },\r\n\r\n    _accessor: {\r\n      value: {\r\n        get: function() {\r\n          return this._count;\r\n        },\r\n        set: function(v) {\r\n          this._count = v;\r\n          this.updateView();\r\n        }\r\n      }\r\n    }\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.OutlinedSprite\", {\r\n    superClass: \"phina.display.Sprite\",\r\n\r\n    init: function(texture, width, height) {\r\n      this.superInit(texture, width, height);\r\n\r\n      var self = this;\r\n\r\n      this.outline = phina.display.Sprite(texture + \"Outline\", width, height).addChildTo(this);\r\n      this.outline.update = function(app) {\r\n        this.frameIndex = self.frameIndex;\r\n        this.alpha = ps.OutlinedSprite.staticAlpha;\r\n      };\r\n      this.outline.draw = function(canvas) {\r\n        phina.display.Sprite.prototype.draw.call(this, canvas);\r\n      }\r\n    },\r\n\r\n    _static: {\r\n      staticAlpha: 1.0\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Player\", {\r\n    superClass: \"ps.OutlinedSprite\",\r\n\r\n    controllable: true,\r\n    muteki: false,\r\n\r\n    roll: 0,\r\n\r\n    speed: 3.6,\r\n\r\n    init: function() {\r\n      this.superInit(\"player\", 32, 32);\r\n      this.frameIndex = 4;\r\n    },\r\n\r\n    update: function(app) {\r\n      if (!this.controllable) return;\r\n\r\n      var kb = app.keyboard;\r\n      var gp = app.gamepads.get(0);\r\n      var p = app.pointer;\r\n\r\n      moveVector.set(0, 0);\r\n\r\n      moveVector.add(kb.getKeyDirection().mul(this.speed));\r\n      if (gp) {\r\n        var stick = gp.getStickDirection();\r\n        if (0.4 < stick.length()) {\r\n          moveVector.add(stick.normalize().mul(this.speed));\r\n        }\r\n      }\r\n      if (p.getPointing()) {\r\n        moveVector.add(p.deltaPosition.mul(2));\r\n      }\r\n\r\n      if (moveVector.x) {\r\n        this.roll = Math.clamp(this.roll + moveVector.x * 0.1, -4, 4);\r\n      } else {\r\n        this.roll *= 0.8;\r\n        if (Math.abs(this.roll) < 0.1) {\r\n          this.roll = 0;\r\n        }\r\n      }\r\n      if (this.roll !== 0) {\r\n        var sign = this.roll / Math.abs(this.roll);\r\n        var r = ~~(Math.abs(this.roll)) * sign;\r\n        this.frameIndex = Math.clamp(4 + r, 0, 8);\r\n      }\r\n\r\n      this.position.add(moveVector);\r\n      this.position.x = Math.clamp(this.position.x, 4, GAMEAREA_WIDTH - 4);\r\n      this.position.y = Math.clamp(this.position.y, 4, GAMEAREA_HEIGHT - 4);\r\n    },\r\n\r\n    launch: function() {\r\n      // TODO\r\n      this.x = GAMEAREA_WIDTH * 0.5;\r\n      this.y = GAMEAREA_HEIGHT * 0.9;\r\n    },\r\n\r\n  });\r\n\r\n  var moveVector = phina.geom.Vector2(0, 0);\r\n\r\n  phina.define(\"ps.AfterBurner\", {\r\n    superClass: \"phina.app.Object2D\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n    },\r\n\r\n    update: function(app) {\r\n      if (app.ticker.frame % 2 !== 0) return;\r\n      phina.display.Sprite(\"particleW\")\r\n        .setPosition(this.position.x, this.position.y)\r\n        .on(\"enterframe\", function() {\r\n          this.position.y += 1.8;\r\n          this.alpha *= 0.4;\r\n          if (this.alpha < 0.01) this.remove();\r\n        })\r\n        .addChildTo(this.parent);\r\n    },\r\n\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.ScoreLabel\", {\r\n    superClass: \"phina.display.Label\",\r\n\r\n    init: function(options) {\r\n      this.superInit((options || {}).$safe({\r\n        fill: \"white\",\r\n        stroke: null,\r\n        fontSize: FONT_SIZE_L,\r\n        fontFamily: \"mono\",\r\n        align: \"right\",\r\n        baseline: \"middle\",\r\n      }));\r\n\r\n      this.value = 0;\r\n    },\r\n\r\n    formatText: function() {\r\n      var v = \"\" + Math.floor(this._score);\r\n      Array.range(5, 0).forEach(function(i) {\r\n        var s = i * 3;\r\n        if (s < v.length) {\r\n          v = v.substring(0, v.length - s) + \",\" + v.substring(v.length - s);\r\n        }\r\n      });\r\n\r\n      this.text = v;\r\n    },\r\n    // formatText: function() {\r\n    //   var v = \"\" + Math.floor(this._score);\r\n    //   if (12 < v.length) {\r\n    //     v = v.substring(0, v.length - 12) + \"兆\" + v.substring(v.length - 12);\r\n    //   }\r\n    //   if (8 < v.length) {\r\n    //     v = v.substring(0, v.length - 8) + \"億\" + v.substring(v.length - 8);\r\n    //   }\r\n    //   if (4 < v.length) {\r\n    //     v = v.substring(0, v.length - 4) + \"万\" + v.substring(v.length - 4);\r\n    //   }\r\n\r\n    //   this.text = v;\r\n    // },\r\n\r\n    _accessor: {\r\n      value: {\r\n        get: function() {\r\n          return this._score;\r\n        },\r\n        set: function(v) {\r\n          this._score = v;\r\n          this.formatText();\r\n        }\r\n      }\r\n    }\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Shot\", {\r\n    superClass: \"phina.display.Sprite\",\r\n\r\n    init: function() {\r\n      this.superInit(\"bullet\", 32, 32);\r\n      this.frameIndex = 0;\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.TitleLogoLabel\", {\r\n    superClass: \"phina.display.Label\",\r\n\r\n    init: function(options) {\r\n      this.superInit((options || {}).$safe({\r\n        text: \"Phina Shooter\",\r\n        align: \"center\",\r\n        fontFamily: \"title\",\r\n        fontSize: FONT_SIZE_L,\r\n        stroke: ps.Color.pri[6],\r\n        fill: ps.Color.pri[13],\r\n      }));\r\n    }\r\n\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.ZankiDisplay\", {\r\n    superClass: \"ps.ItemDisplay\",\r\n\r\n    init: function(initialValue) {\r\n      this.superInit(\"zanki\", initialValue);\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.BulletConfig\", {\r\n\r\n    speedRate: 3,\r\n    target: null,\r\n    bulletLayer: null,\r\n\r\n    init: function(target, bulletLayer) {\r\n      this.target = target;\r\n      this.bulletLayer = bulletLayer;\r\n      \r\n      this.put(\"densityRank\", 0.0);\r\n      this.put(\"speedRank\", 0.0);\r\n      this.put(\"burst\", 0);\r\n    },\r\n\r\n    createNewBullet: function(runner, spec) {\r\n      this.bulletLayer.spawn(runner, spec);\r\n    },\r\n    \r\n    put: function(name, value) {\r\n      bulletml.Walker.globalScope[\"$\" + name] = value;\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.GameData\", {\r\n    superClass: \"phina.util.EventDispatcher\",\r\n\r\n    currentStage: 0,\r\n\r\n    score: Math.randint(0, 100000000000),\r\n    zanki: 2,\r\n    bomb: 3,\r\n    psyche: Math.randint(0, 100000000000),\r\n    highScore: Math.randint(0, 100000000000),\r\n\r\n    /**\r\n     * \"normal\" or \"every\"\r\n     */\r\n    extendMode: null,\r\n    extendScore: null,\r\n\r\n    init: function() {\r\n      this.superInit();\r\n      this._binder = {};\r\n\r\n      this.extendMode = \"normal\";\r\n      this.extendScore = [100000000, 200000000];\r\n    },\r\n\r\n    updateView: function(frame) {\r\n      if (frame % 5 !== 0) return;\r\n\r\n      var self = this;\r\n      self._binder.forIn(function(name, view) {\r\n        if (self[name] !== undefined) {\r\n          view.value = self[name];\r\n        }\r\n      });\r\n    },\r\n\r\n    miss: function() {\r\n      this.zanki -= 1;\r\n      this.psyche = 0;\r\n    },\r\n\r\n    useBomb: function() {\r\n      this.bomb -= 1;\r\n      this.psyche *= 0.7;\r\n    },\r\n\r\n    addPsyche: function(v) {\r\n      this.psyche += v;\r\n    },\r\n\r\n    addScore: function(v) {\r\n      var self = this;\r\n      var before = this.score;\r\n      var after = this.score + v;\r\n\r\n      if (this.extendMode === \"normal\") {\r\n        this.extendScore.forEach(function(es) {\r\n          if (before < es && es <= after) {\r\n            self.zanki += 1;\r\n            self.flare(\"extend\");\r\n          }\r\n        });\r\n      } else if (this.extendMode === \"every\") {\r\n        var es = this.extendScore[0];\r\n        if (Math.floor(before / es) < Math.floor(after / es)) {\r\n          this.zanki += 1;\r\n          this.flare(\"extend\");\r\n        }\r\n      }\r\n\r\n      this.score = after;\r\n    },\r\n\r\n    bind: function(propertyName, view) {\r\n      this._binder[propertyName] = view;\r\n    }\r\n\r\n  });\r\n\r\n});\r\n","phina.main(function() {\r\n  var s = 10;\r\n  var l = s * Math.sqrt(3);\r\n  var bg = phina.graphics.Canvas();\r\n  bg.setSize(l * 2, s * 6);\r\n  bg.strokeStyle = \"hsla(240, 8%, 50%, 0.3)\";\r\n  bg.strokeLines(\r\n    l, 0,\r\n    l, s,\r\n    0, s * 2,\r\n    0, s * 4,\r\n    l, s * 5,\r\n    l, s * 6\r\n  );\r\n  bg.strokeLines(l, s, l * 2, s * 2);\r\n  bg.strokeLines(l, s * 5, l * 2, s * 4);\r\n  document.body.style.backgroundImage = \"url({0})\".format(bg.canvas.toDataURL());\r\n  document.body.style.backgroundRepeat = \"repeat\";\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.EndingScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.GameoverScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.GameScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    stageId: null,\r\n    gameData: null,\r\n    bulletConfig: null,\r\n\r\n    init: function(params) {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"hsl(30, 60%, 60%)\",\r\n      });\r\n\r\n      ps.TextureEdit.outline(\"bullet\", \"red\");\r\n      ps.TextureEdit.outline(\"player\");\r\n      ps.TextureEdit.outline(\"bomb\", \"lightgreen\");\r\n\r\n      var c = phina.graphics.Canvas().setSize(5, 5);\r\n      c.clearColor(\"rgba(255, 255, 255, 0.5)\");\r\n      phina.asset.AssetManager.set(\"image\", \"particleW\", c);\r\n\r\n      this.stage = ps.Stage.create(params.stageId);\r\n\r\n      this.fromJSON({\r\n        children: {\r\n          mainLayer: {\r\n            className: \"ps.gamescene.MainLayer\",\r\n            arguments: {\r\n              stage: this.stage,\r\n            },\r\n            x: SIDEBAR_WIDTH,\r\n            y: 0,\r\n          },\r\n          leftSideBar: {\r\n            className: \"ps.gamescene.LeftSideBar\",\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          rightSideBar: {\r\n            className: \"ps.gamescene.RightSideBar\",\r\n            x: SCREEN_WIDTH - SIDEBAR_WIDTH,\r\n            y: 0,\r\n          },\r\n        }\r\n      });\r\n\r\n      this.gameData = params.gameData;\r\n      this.leftSideBar.bindGameData(this.gameData);\r\n      this.rightSideBar.bindGameData(this.gameData);\r\n      this.bulletConfig = ps.BulletConfig(this.mainLayer.player, this.mainLayer.bulletLayer);\r\n\r\n      runner = ps.danmaku.akimoto1.createRunner(this.bulletConfig);\r\n      runner.x = GAMEAREA_WIDTH * 0.5;\r\n      runner.y = GAMEAREA_HEIGHT * 0.2;\r\n    },\r\n\r\n    update: function(app) {\r\n      var frame = app.ticker.frame;\r\n\r\n      this.gameData.updateView(frame);\r\n      runner.update();\r\n\r\n      ps.OutlinedSprite.staticAlpha = 0.5 + Math.sin(frame * 0.15) * 0.5;\r\n    },\r\n\r\n    launchEnemy: function(enemy) {\r\n      // TODO\r\n    },\r\n\r\n  });\r\n\r\n  var runner;\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.LoadingScene\", {\r\n    superClass: \"phina.game.LoadingScene\",\r\n\r\n    init: function(params) {\r\n      this.superInit({\r\n        assets: ps.Assets.get(params.assetType),\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        lie: false,\r\n        exitType: \"auto\",\r\n      });\r\n      this.fromJSON({\r\n        backgroundColor: \"black\",\r\n        children: {\r\n          label: {\r\n            className: \"ps.TitleLogoLabel\",\r\n            arguments: {\r\n              text: \"downloading\"\r\n            },\r\n            x: SCREEN_WIDTH * 0.5,\r\n            y: SCREEN_HEIGHT * 0.5,\r\n            onenterframe: function(e) {\r\n              var c = ~~(e.app.ticker.frame / 10) % 5;\r\n              this.text = \"downloading\" + \".\".repeat(c);\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.NameEntryScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.ResultScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function(params) {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n\r\n      this.fromJSON({\r\n        gameData: params.gameData,\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.SettingScene\", {\r\n    superClass: \"phina.game.ManagerScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        scenes: [\r\n\r\n          {\r\n            label: \"top\",\r\n            className: \"ps.settingscene.Top\",\r\n          },\r\n\r\n        ],\r\n      });\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.settingscene.Top\", {\r\n    superClass: \"phina.app.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.TitleScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n\r\n      this.fromJSON({\r\n        children: {\r\n          title: {\r\n            className: \"ps.TitleLogoLabel\",\r\n            arguments: {\r\n              fontSize: FONT_SIZE_XL,\r\n            },\r\n            x: SCREEN_WIDTH * 0.5,\r\n            y: SCREEN_HEIGHT * 0.5,\r\n          }\r\n        }\r\n      });\r\n\r\n      this.tweener.wait(500).call(function() {\r\n        this.exit(\"arcadeMode\");\r\n      }.bind(this));\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.TutorialScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  /**\r\n   * arcadeモード\r\n   */\r\n  phina.define(\"ps.ArcadeModeSequence\", {\r\n    superClass: \"phina.game.ManagerScene\",\r\n    \r\n    init: function() {\r\n      \r\n      var gameData = ps.GameData();\r\n      \r\n      this.superInit({\r\n        scenes: [\r\n\r\n          Array.range(0, 5).map(function(stageId) {\r\n            var stageName = \"stage{0}\".format(stageId);\r\n            if (stageId < 4) {\r\n              next = \"stage{0}preload\".format(stageId + 1);\r\n            } else {\r\n              next = \"ending\";\r\n            }\r\n            return [\r\n\r\n              {\r\n                label: stageName + \"preload\",\r\n                className: \"ps.LoadingScene\",\r\n                arguments: {\r\n                  assetType: stageName\r\n                },\r\n                nextLabel: stageName,\r\n              },\r\n\r\n              {\r\n                label: stageName,\r\n                className: \"ps.GameScene\",\r\n                arguments: {\r\n                  stageId: stageId,\r\n                  gameData: gameData,\r\n                },\r\n                nextLabel: stageName + \"result\",\r\n              },\r\n\r\n              {\r\n                label: stageName + \"result\",\r\n                className: \"ps.ResultScene\",\r\n                arguments: {\r\n                  gameData: gameData,\r\n                },\r\n                nextLabel: next,\r\n              },\r\n\r\n            ];\r\n          }),\r\n\r\n          {\r\n            label: \"ending\",\r\n            className: \"ps.EndingScene\",\r\n            nextLabel: \"gameover\",\r\n          },\r\n\r\n          {\r\n            label: \"gameover\",\r\n            className: \"ps.GameoverScene\",\r\n            nextLabel: \"nameEntry\",\r\n          },\r\n\r\n          {\r\n            label: \"nameEntry\",\r\n            className: \"ps.NameEntryScene\",\r\n          },\r\n\r\n        ].flatten(),\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.MainSequence\", {\r\n    superClass: \"phina.game.ManagerScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        scenes: [\r\n\r\n          {\r\n            label: \"load\",\r\n            className: \"ps.LoadingScene\",\r\n            arguments: {\r\n              assetType: \"common\"\r\n            },\r\n            nextLabel: \"title\",\r\n          },\r\n\r\n          {\r\n            label: \"title\",\r\n            className: \"ps.TitleScene\",\r\n          },\r\n\r\n          {\r\n            label: \"arcadeMode\",\r\n            className: \"ps.ArcadeModeSequence\",\r\n            nextLabel: \"title\",\r\n          },\r\n\r\n          {\r\n            label: \"tutorial\",\r\n            className: \"ps.TutorialScene\",\r\n            nextLabel: \"title\",\r\n          },\r\n\r\n          {\r\n            label: \"setting\",\r\n            className: \"ps.SettingScene\",\r\n            nextLabel: \"title\",\r\n          },\r\n\r\n          {\r\n            label: \"ranking\",\r\n            className: \"ps.RankingScene\",\r\n            nextLabel: \"title\",\r\n          },\r\n\r\n        ],\r\n      });\r\n    }\r\n  });\r\n\r\n});","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.RankingScene\", {\r\n    superClass: \"phina.display.CanvasScene\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"black\",\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Background1\", {\r\n    superClass: \"ps.BackgroundLayer\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        backgroundColor: ps.Color.pri[1],\r\n        fill: ps.Color.pria[7].format(0.2),\r\n        stroke: ps.Color.pri[4],\r\n      });\r\n\r\n      this.camera.x = 2;\r\n      this.camera.y = 35;\r\n      this.camera.z = 8;\r\n      this.camera.targetY = 3;\r\n      var frame = 0;\r\n      this.camera.on(\"enterframe\", function(e) {\r\n        this.y = 18 + Math.cos(frame * 0.001) * 14;\r\n        frame += 1;\r\n      });\r\n\r\n      var self = this;\r\n\r\n      var dx = 0.02;\r\n      var dz = 0.08;\r\n\r\n      var rangeX2 = 2.6 * 10;\r\n      var rangeZ2 = 2.6 * 10;\r\n      var vertices2 = [\r\n        [0, 0, 0],\r\n      ];\r\n      Array.range(-10, 10).forEach(function(z) {\r\n        Array.range(-10, 10).forEach(function(x) {\r\n          ps.bg.Polygon({\r\n              vertices: vertices2,\r\n            })\r\n            .setTranslation(x * 2.6, 0, z * 2.6)\r\n            .addChildTo(self)\r\n            .on(\"enterframe\", function() {\r\n              this.x += dx;\r\n              this.z += dz;\r\n\r\n              if (this.x < -rangeX2) this.x += rangeX2 * 2;\r\n              if (rangeX2 < this.x) this.x += -rangeX2 * 2;\r\n              if (this.z < -rangeZ2) this.z += rangeZ2 * 2;\r\n              if (rangeZ2 < this.z) this.z += -rangeZ2 * 2;\r\n            });\r\n        });\r\n      });\r\n\r\n      var rangeX = 3.0 * 5.0;\r\n      var rangeZ = 4.0 * 5.6;\r\n      var vertices = [\r\n        [-0.5, 0, -0.5],\r\n        [-0.5, 0, +0.5],\r\n        [+0.5, 0, +0.5],\r\n        [+0.5, 0, -0.5],\r\n      ];\r\n      var random = phina.util.Random(12345);\r\n      Array.range(-5, 5).forEach(function(z) {\r\n        Array.range(-5, 5).forEach(function(x) {\r\n          Array.range(0, random.randint(4, 9)).forEach(function(y) {\r\n            ps.bg.Polygon({\r\n                vertices: vertices,\r\n              })\r\n              .setTranslation(x * 3.0, y * 0.21, z * 4.0)\r\n              .addChildTo(self)\r\n              .on(\"enterframe\", function() {\r\n                this.x += dx;\r\n                this.z += dz;\r\n\r\n                if (this.x < -rangeX) this.x += rangeX * 2;\r\n                if (rangeX < this.x) this.x += -rangeX * 2;\r\n                if (this.z < -rangeZ) this.z += rangeZ * 2;\r\n                if (rangeZ < this.z) this.z += -rangeZ * 2;\r\n              });\r\n          });\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Stage\", {\r\n    superClass: \"phina.util.EventDispatcher\",\r\n\r\n    waitFor: -1,\r\n    sequencer: null,\r\n\r\n    init: function() {\r\n      this.superInit();\r\n\r\n      this.sequencer = ps.StageSequancer();\r\n    },\r\n\r\n    update: function(app) {\r\n      var frame = app.ticker.frame;\r\n      while (this.waitFor <= frame) {\r\n        var task = this.sequencer.next();\r\n        if (task) {\r\n          task.execute(app, app.currentScene, this);\r\n        }\r\n      }\r\n    },\r\n\r\n    _static: {\r\n      create: function(stageId) {\r\n        switch (stageId) {\r\n          case 0:\r\n            return ps.Stage1();\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.StageSequancer\", {\r\n\r\n    init: function() {\r\n      this.seq = [];\r\n    },\r\n\r\n    addTask: function(task) {\r\n      this.seq.push(task);\r\n      return this;\r\n    },\r\n\r\n    next: function() {\r\n      return this.seq.shift();\r\n    },\r\n\r\n    wait: function(frame) {\r\n      return this.addTask(ps.StageTask(frame));\r\n    },\r\n\r\n    playBgm: function(bgmData) {\r\n      return this.addTask(ps.PlayBgmTask(bgmData));\r\n    },\r\n\r\n    stopBgm: function() {\r\n      return this.addTask(ps.StopBgmTask());\r\n    },\r\n\r\n    warning: function() {\r\n      return this.addTask(ps.WarningTask());\r\n    },\r\n\r\n    launchEnemy: function(enemyClassName, params) {\r\n      return this.addTask(ps.LaunchEnemyTask(enemyClassName, params));\r\n    },\r\n\r\n    launchBoss: function(bossClassName) {\r\n      return this.addTask(ps.LaunchBossTask(bossClassName));\r\n    },\r\n  });\r\n\r\n  phina.define(\"ps.StageTask\", {\r\n    init: function() {},\r\n    execute: function(app, gameScene, stage) {}\r\n  });\r\n\r\n  phina.define(\"ps.WaitTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    frame: 0,\r\n\r\n    init: function(frame) {\r\n      this.frame = frame;\r\n    },\r\n\r\n    execute: function(app, gameScene, stage) {\r\n      stage.waitFor = app.ticker.frame + this.frame;\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.PlayBgmTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    bgmData: null,\r\n\r\n    init: function(bgmData) {\r\n      this.superInit();\r\n      this.bgmData = bgmData;\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.StopBgmTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.WarningTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.LaunchEnemyTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    enemyClassName: null,\r\n    params: null,\r\n\r\n    init: function(enemyClassName, params) {\r\n      this.superInit();\r\n      this.enemyClassName = enemyClassName;\r\n      this.params = params;\r\n    }\r\n  });\r\n\r\n  phina.define(\"ps.LaunchBossTask\", {\r\n    superClass: \"ps.StageTask\",\r\n\r\n    bossClassName: null,\r\n\r\n    init: function(bossClassName, params) {\r\n      this.superInit();\r\n      this.bossClassName = bossClassName;\r\n      this.params = params;\r\n    }\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.Stage1\", {\r\n    superClass: \"ps.Stage\",\r\n\r\n    backgroundClassName: \"ps.Background1\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n    }\r\n\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"ps.TextureEdit\", {\r\n    init: function() {},\r\n    _static: {\r\n      outline: function(textureName, color, lineWidth) {\r\n        color = color || \"white\";\r\n        lineWidth = lineWidth || 1;\r\n\r\n        var texture = phina.asset.AssetManager.get(\"image\", textureName);\r\n        if (texture == null) {\r\n          return;\r\n        }\r\n        var w = texture.domElement.width;\r\n        var h = texture.domElement.height;\r\n\r\n        var src = phina.graphics.Canvas().setSize(w, h);\r\n        src.context.drawImage(texture.domElement, 0, 0);\r\n\r\n        var srcData = src.context.getImageData(0, 0, w, h);\r\n        var data = srcData.data;\r\n\r\n        var dst = phina.graphics.Canvas().setSize(w, h);\r\n        dst.fillStyle = color;\r\n        for (var y = 0; y < h; y++) {\r\n          for (var x = 0; x < w; x++) {\r\n\r\n            var cIndex = ((y + 0) * w + (x + 0)) * 4 + 3;\r\n\r\n            var lIndex = ((y + 0) * w + (x - 1)) * 4 + 3;\r\n            var rIndex = ((y + 0) * w + (x + 1)) * 4 + 3;\r\n            var tIndex = ((y - 1) * w + (x + 0)) * 4 + 3;\r\n            var bIndex = ((y + 1) * w + (x + 0)) * 4 + 3;\r\n            var l = (0 <= lIndex && lIndex < data.length) ? data[lIndex] : 255;\r\n            var r = (0 <= rIndex && rIndex < data.length) ? data[rIndex] : 255;\r\n            var t = (0 <= tIndex && tIndex < data.length) ? data[tIndex] : 255;\r\n            var b = (0 <= bIndex && bIndex < data.length) ? data[bIndex] : 255;\r\n\r\n            var a = data[cIndex];\r\n\r\n            if (a > 0 && (l == 0 || r == 0 || t == 0 || b == 0)) {\r\n              dst.fillRect(x - lineWidth * 0.5, y - lineWidth * 0.5, lineWidth, lineWidth);\r\n            }\r\n          }\r\n        }\r\n\r\n        phina.asset.AssetManager.set(\"image\", textureName + \"Outline\", dst);\r\n      }\r\n    }\r\n  });\r\n\r\n});\r\n"],"sourceRoot":"/source/"}